<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Therapy Session - TherapyTrack</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .domain-section {
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        .domain-header {
            background: var(--bg-primary);
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition-fast);
        }
        .domain-header:hover {
            background: rgba(102, 126, 234, 0.05);
        }
        .domain-header h4 {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }
        .domain-content {
            padding: 25px;
            display: none;
        }
        .domain-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .skill-item:last-child {
            border-bottom: none;
        }
        .skill-label {
            font-weight: 500;
            color: var(--text-primary);
        }
        .rating-buttons {
            display: flex;
            gap: 8px;
        }
        .rating-btn {
            padding: 8px 16px;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius-xl);
            background: white;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85rem;
            transition: var(--transition-fast);
        }
        .rating-btn:hover {
            border-color: var(--primary-color);
        }
        .rating-btn.active.good {
            background: var(--secondary-gradient);
            color: white;
            border-color: transparent;
        }
        .rating-btn.active.average {
            background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
            color: white;
            border-color: transparent;
        }
        .rating-btn.active.no-improvement {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border-color: transparent;
        }
        .subsection-title {
            font-weight: 600;
            color: var(--primary-color);
            margin: 20px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
        }
        .progress-indicator {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: var(--border-radius-md);
        }
        .progress-step {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
        }
        .progress-step.active {
            color: var(--primary-color);
        }
        .progress-step.completed {
            color: #11998e;
        }
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e2e8f0;
            font-weight: 600;
            font-size: 0.85rem;
        }
        .progress-step.active .step-number {
            background: var(--primary-gradient);
            color: white;
        }
        .progress-step.completed .step-number {
            background: var(--secondary-gradient);
            color: white;
        }
        .chevron-icon {
            transition: transform 0.3s ease;
        }
        .domain-header.expanded .chevron-icon {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="/" class="logo">
                <div class="logo-icon">ðŸŒˆ</div>
                <span class="logo-text">TherapyTrack</span>
            </a>
        </div>
        <ul class="sidebar-menu">
            <li><a href="/doctor/dashboard"><i class="fas fa-home"></i><span>Dashboard</span></a></li>
            <li><a href="/doctor/add-child"><i class="fas fa-user-plus"></i><span>Add Child</span></a></li>
            <li><a href="/doctor/dashboard"><i class="fas fa-child"></i><span>My Children</span></a></li>
            <li><a href="#" class="active"><i class="fas fa-calendar-check"></i><span>Sessions</span></a></li>
            <li><a href="#"><i class="fas fa-chart-bar"></i><span>Reports</span></a></li>
            <li style="margin-top: auto; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 15px;">
                <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <a href="/doctor/dashboard" class="btn btn-ghost btn-icon">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <div>
                    <h1 class="page-title">Add Therapy Session</h1>
                    <p class="page-subtitle">Record session details for <span id="childNameHeader">Child</span></p>
                </div>
            </div>
        </div>

        <form id="sessionForm">
            <!-- Session Info Card -->
            <div class="card animate-fadeInUp" style="margin-bottom: 25px;">
                <div class="card-body" style="padding: 30px;">
                    <h3 style="margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-clipboard" style="color: var(--primary-color);"></i>
                        Session Details
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">Session Date *</label>
                            <input type="date" class="form-input" id="sessionDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duration (minutes) *</label>
                            <input type="number" class="form-input" id="duration" placeholder="e.g., 60" min="15" max="180" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Session Type</label>
                            <select class="form-select" id="sessionType">
                                <option value="individual">Individual Session</option>
                                <option value="group">Group Session</option>
                                <option value="assessment">Assessment</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Activities Performed *</label>
                        <textarea class="form-textarea" id="activities" placeholder="Describe the activities performed during this session..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Session Notes</label>
                        <textarea class="form-textarea" id="notes" placeholder="Additional observations and notes..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Developmental Domains -->
            <h2 style="margin-bottom: 20px; color: var(--text-primary);">
                <i class="fas fa-brain" style="color: var(--primary-color); margin-right: 10px;"></i>
                Developmental Domain Ratings
            </h2>

            <!-- Domain 1: Communication Skills -->
            <div class="domain-section animate-fadeInUp">
                <div class="domain-header" onclick="toggleDomain(this)">
                    <h4>
                        <span style="width: 40px; height: 40px; background: rgba(102, 126, 234, 0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--primary-color);">
                            <i class="fas fa-comments"></i>
                        </span>
                        Communication & Speaking Skills
                    </h4>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="domain-content">
                    <h5 class="subsection-title">Verbal Skills</h5>
                    <div class="skill-item">
                        <span class="skill-label">Ability to speak words/sentences</span>
                        <div class="rating-buttons" data-skill="verbal_speak_words_sentences">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Clarity & pronunciation</span>
                        <div class="rating-buttons" data-skill="verbal_clarity_pronunciation">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Expressing needs</span>
                        <div class="rating-buttons" data-skill="verbal_expressing_needs">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Turn taking in conversation</span>
                        <div class="rating-buttons" data-skill="verbal_turn_taking">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Initiating conversation</span>
                        <div class="rating-buttons" data-skill="verbal_initiating_conversation">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Vocabulary</span>
                        <div class="rating-buttons" data-skill="verbal_vocabulary">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Functional speech</span>
                        <div class="rating-buttons" data-skill="verbal_functional_speech">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>

                    <h5 class="subsection-title">Non-Verbal Skills</h5>
                    <div class="skill-item">
                        <span class="skill-label">Eye contact</span>
                        <div class="rating-buttons" data-skill="nonverbal_eye_contact">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Gestures</span>
                        <div class="rating-buttons" data-skill="nonverbal_gestures">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Facial expressions</span>
                        <div class="rating-buttons" data-skill="nonverbal_facial_expressions">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Body language</span>
                        <div class="rating-buttons" data-skill="nonverbal_body_language">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Following directions</span>
                        <div class="rating-buttons" data-skill="nonverbal_following_directions">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Domain 2: Emotional Development -->
            <div class="domain-section animate-fadeInUp delay-100">
                <div class="domain-header" onclick="toggleDomain(this)">
                    <h4>
                        <span style="width: 40px; height: 40px; background: rgba(255, 107, 107, 0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #ff6b6b;">
                            <i class="fas fa-heart"></i>
                        </span>
                        Emotional Development
                    </h4>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="domain-content">
                    <div class="skill-item">
                        <span class="skill-label">Identify own emotions</span>
                        <div class="rating-buttons" data-skill="emotional_identify_own">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Identify emotions in others</span>
                        <div class="rating-buttons" data-skill="emotional_identify_others">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Emotional regulation</span>
                        <div class="rating-buttons" data-skill="emotional_regulation">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Sensory overload response</span>
                        <div class="rating-buttons" data-skill="emotional_sensory_overload">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Coping strategies</span>
                        <div class="rating-buttons" data-skill="emotional_coping">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Domain 3: Social Skills -->
            <div class="domain-section animate-fadeInUp delay-200">
                <div class="domain-header" onclick="toggleDomain(this)">
                    <h4>
                        <span style="width: 40px; height: 40px; background: rgba(17, 153, 142, 0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #11998e;">
                            <i class="fas fa-user-friends"></i>
                        </span>
                        Social Skills
                    </h4>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="domain-content">
                    <div class="skill-item">
                        <span class="skill-label">Playing with peers</span>
                        <div class="rating-buttons" data-skill="social_playing_peers">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Sharing / turn-taking</span>
                        <div class="rating-buttons" data-skill="social_sharing">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Understanding social rules</span>
                        <div class="rating-buttons" data-skill="social_rules">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Joint attention</span>
                        <div class="rating-buttons" data-skill="social_joint_attention">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Imitation skills</span>
                        <div class="rating-buttons" data-skill="social_imitation">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Response to name</span>
                        <div class="rating-buttons" data-skill="social_response_name">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Group participation</span>
                        <div class="rating-buttons" data-skill="social_group">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Domain 4: Behavior -->
            <div class="domain-section animate-fadeInUp delay-300">
                <div class="domain-header" onclick="toggleDomain(this)">
                    <h4>
                        <span style="width: 40px; height: 40px; background: rgba(243, 156, 18, 0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #f39c12;">
                            <i class="fas fa-tasks"></i>
                        </span>
                        Behavior
                    </h4>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="domain-content">
                    <div class="skill-item">
                        <span class="skill-label">Aggression management</span>
                        <div class="rating-buttons" data-skill="behavior_aggression">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Self-injury prevention</span>
                        <div class="rating-buttons" data-skill="behavior_self_injury">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Eloping (running away)</span>
                        <div class="rating-buttons" data-skill="behavior_eloping">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Following routines</span>
                        <div class="rating-buttons" data-skill="behavior_routines">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Flexibility to change</span>
                        <div class="rating-buttons" data-skill="behavior_flexibility">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Response to reinforcement</span>
                        <div class="rating-buttons" data-skill="behavior_reinforcement">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Domain 5: Cognitive Skills -->
            <div class="domain-section animate-fadeInUp">
                <div class="domain-header" onclick="toggleDomain(this)">
                    <h4>
                        <span style="width: 40px; height: 40px; background: rgba(155, 89, 182, 0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #9b59b6;">
                            <i class="fas fa-brain"></i>
                        </span>
                        Cognitive & Learning Skills
                    </h4>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="domain-content">
                    <div class="skill-item">
                        <span class="skill-label">Attention span</span>
                        <div class="rating-buttons" data-skill="cognitive_attention">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Focus</span>
                        <div class="rating-buttons" data-skill="cognitive_focus">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Memory</span>
                        <div class="rating-buttons" data-skill="cognitive_memory">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Problem solving</span>
                        <div class="rating-buttons" data-skill="cognitive_problem_solving">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Matching, sorting, sequencing</span>
                        <div class="rating-buttons" data-skill="cognitive_sorting">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Learning new concepts</span>
                        <div class="rating-buttons" data-skill="cognitive_learning">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Basic academics</span>
                        <div class="rating-buttons" data-skill="cognitive_academics">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Domain 6: Sensory Processing -->
            <div class="domain-section animate-fadeInUp">
                <div class="domain-header" onclick="toggleDomain(this)">
                    <h4>
                        <span style="width: 40px; height: 40px; background: rgba(52, 152, 219, 0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #3498db;">
                            <i class="fas fa-hand-paper"></i>
                        </span>
                        Sensory Processing
                    </h4>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="domain-content">
                    <div class="skill-item">
                        <span class="skill-label">Hyper/Hypo sensitivity management</span>
                        <div class="rating-buttons" data-skill="sensory_sensitivity">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Stimming regulation</span>
                        <div class="rating-buttons" data-skill="sensory_stimming">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Sensory seeking behavior</span>
                        <div class="rating-buttons" data-skill="sensory_seeking">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Light/sound/touch tolerance</span>
                        <div class="rating-buttons" data-skill="sensory_tolerance">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Food selectiveness</span>
                        <div class="rating-buttons" data-skill="sensory_food">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Domain 7: Daily Living Skills -->
            <div class="domain-section animate-fadeInUp">
                <div class="domain-header" onclick="toggleDomain(this)">
                    <h4>
                        <span style="width: 40px; height: 40px; background: rgba(26, 188, 156, 0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #1abc9c;">
                            <i class="fas fa-home"></i>
                        </span>
                        Daily Living Skills
                    </h4>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="domain-content">
                    <div class="skill-item">
                        <span class="skill-label">Eating independently</span>
                        <div class="rating-buttons" data-skill="daily_eating">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Dressing</span>
                        <div class="rating-buttons" data-skill="daily_dressing">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Toilet training</span>
                        <div class="rating-buttons" data-skill="daily_toilet">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Brushing teeth</span>
                        <div class="rating-buttons" data-skill="daily_brushing">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Hand washing</span>
                        <div class="rating-buttons" data-skill="daily_handwashing">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Safety awareness</span>
                        <div class="rating-buttons" data-skill="daily_safety">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Domain 8: Therapy Participation -->
            <div class="domain-section animate-fadeInUp">
                <div class="domain-header" onclick="toggleDomain(this)">
                    <h4>
                        <span style="width: 40px; height: 40px; background: rgba(231, 76, 60, 0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #e74c3c;">
                            <i class="fas fa-hand-holding-heart"></i>
                        </span>
                        Therapy Participation
                    </h4>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="domain-content">
                    <div class="skill-item">
                        <span class="skill-label">Sitting tolerance</span>
                        <div class="rating-buttons" data-skill="participation_sitting">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Responsiveness</span>
                        <div class="rating-buttons" data-skill="participation_responsiveness">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Engagement level</span>
                        <div class="rating-buttons" data-skill="participation_engagement">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Prompt dependency</span>
                        <div class="rating-buttons" data-skill="participation_prompt">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                    <div class="skill-item">
                        <span class="skill-label">Transitioning between tasks</span>
                        <div class="rating-buttons" data-skill="participation_transitioning">
                            <button type="button" class="rating-btn" data-value="good">Good</button>
                            <button type="button" class="rating-btn" data-value="average">Average</button>
                            <button type="button" class="rating-btn" data-value="no_improvement">No Improvement</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                <a href="/doctor/dashboard" class="btn btn-ghost">Cancel</a>
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i>
                    Save Session
                </button>
            </div>
        </form>
    </main>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal" style="text-align: center;">
            <div class="modal-body" style="padding: 50px 30px;">
                <div style="width: 80px; height: 80px; background: var(--secondary-gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 25px; font-size: 2rem;">
                    <i class="fas fa-check" style="color: white;"></i>
                </div>
                <h2 style="margin-bottom: 15px; color: var(--text-primary);">Session Saved! ðŸŽ‰</h2>
                <p style="color: var(--text-secondary); margin-bottom: 25px;">The therapy session has been recorded successfully.</p>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <a href="/doctor/dashboard" class="btn btn-primary">Back to Dashboard</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="/static/js/app.js"></script>
    <script>
        const token = localStorage.getItem('token');
        const userType = localStorage.getItem('userType');
        const childId = window.location.pathname.split('/').pop();

        if (!token || userType !== 'doctor') {
            window.location.href = '/login';
        }

        // Set today's date as default
        document.getElementById('sessionDate').valueAsDate = new Date();

        // Load child info
        async function loadChildInfo() {
            try {
                const response = await fetch(`/api/child/${childId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    const child = await response.json();
                    document.getElementById('childNameHeader').textContent = child.name;
                }
            } catch (error) {
                console.error('Error loading child info:', error);
            }
        }

        // Toggle domain section
        function toggleDomain(header) {
            header.classList.toggle('expanded');
            const content = header.nextElementSibling;
            content.classList.toggle('active');
        }

        // Rating button clicks
        document.querySelectorAll('.rating-buttons').forEach(group => {
            group.querySelectorAll('.rating-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    group.querySelectorAll('.rating-btn').forEach(b => {
                        b.classList.remove('active', 'good', 'average', 'no-improvement');
                    });
                    this.classList.add('active', this.dataset.value.replace('_', '-'));
                });
            });
        });

        // Collect ratings
        function collectRatings() {
            const ratings = {};
            document.querySelectorAll('.rating-buttons').forEach(group => {
                const skill = group.dataset.skill;
                const active = group.querySelector('.rating-btn.active');
                if (active) {
                    ratings[skill] = active.dataset.value;
                }
            });
            return ratings;
        }

        // Form submission
        document.getElementById('sessionForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const ratings = collectRatings();
            
            const sessionData = {
                child_id: childId,
                session_date: new Date(document.getElementById('sessionDate').value).toISOString(),
                duration_minutes: parseInt(document.getElementById('duration').value),
                activities_performed: document.getElementById('activities').value,
                notes: document.getElementById('notes').value || '',
                communication_skills: {
                    verbal: {
                        speak_words_sentences: ratings.verbal_speak_words_sentences || null,
                        clarity_pronunciation: ratings.verbal_clarity_pronunciation || null,
                        expressing_needs: ratings.verbal_expressing_needs || null,
                        turn_taking: ratings.verbal_turn_taking || null,
                        initiating_conversation: ratings.verbal_initiating_conversation || null,
                        vocabulary: ratings.verbal_vocabulary || null,
                        functional_speech: ratings.verbal_functional_speech || null
                    },
                    non_verbal: {
                        eye_contact: ratings.nonverbal_eye_contact || null,
                        gestures: ratings.nonverbal_gestures || null,
                        facial_expressions: ratings.nonverbal_facial_expressions || null,
                        body_language: ratings.nonverbal_body_language || null,
                        following_directions: ratings.nonverbal_following_directions || null
                    }
                },
                emotional_development: {
                    identify_own_emotions: ratings.emotional_identify_own || null,
                    identify_others_emotions: ratings.emotional_identify_others || null,
                    emotional_regulation: ratings.emotional_regulation || null,
                    sensory_overload_response: ratings.emotional_sensory_overload || null,
                    coping_strategies: ratings.emotional_coping || null
                },
                social_skills: {
                    playing_with_peers: ratings.social_playing_peers || null,
                    sharing_turn_taking: ratings.social_sharing || null,
                    understanding_social_rules: ratings.social_rules || null,
                    joint_attention: ratings.social_joint_attention || null,
                    imitation_skills: ratings.social_imitation || null,
                    response_to_name: ratings.social_response_name || null,
                    group_participation: ratings.social_group || null
                },
                behavior: {
                    aggression: ratings.behavior_aggression || null,
                    self_injury: ratings.behavior_self_injury || null,
                    eloping: ratings.behavior_eloping || null,
                    following_routines: ratings.behavior_routines || null,
                    flexibility_to_change: ratings.behavior_flexibility || null,
                    response_to_reinforcement: ratings.behavior_reinforcement || null
                },
                cognitive_skills: {
                    attention_span: ratings.cognitive_attention || null,
                    focus: ratings.cognitive_focus || null,
                    memory: ratings.cognitive_memory || null,
                    problem_solving: ratings.cognitive_problem_solving || null,
                    matching_sorting_sequencing: ratings.cognitive_sorting || null,
                    learning_new_concepts: ratings.cognitive_learning || null,
                    basic_academics: ratings.cognitive_academics || null
                },
                sensory_processing: {
                    hyper_hypo_sensitivity: ratings.sensory_sensitivity || null,
                    stimming: ratings.sensory_stimming || null,
                    sensory_seeking: ratings.sensory_seeking || null,
                    light_sound_touch_tolerance: ratings.sensory_tolerance || null,
                    food_selectiveness: ratings.sensory_food || null
                },
                daily_living_skills: {
                    eating_independently: ratings.daily_eating || null,
                    dressing: ratings.daily_dressing || null,
                    toilet_training: ratings.daily_toilet || null,
                    brushing_teeth: ratings.daily_brushing || null,
                    hand_washing: ratings.daily_handwashing || null,
                    safety_awareness: ratings.daily_safety || null
                },
                therapy_participation: {
                    sitting_tolerance: ratings.participation_sitting || null,
                    responsiveness: ratings.participation_responsiveness || null,
                    engagement_level: ratings.participation_engagement || null,
                    prompt_dependency: ratings.participation_prompt || null,
                    transitioning_between_tasks: ratings.participation_transitioning || null
                }
            };

            try {
                const response = await fetch('/api/therapy/add-log', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(sessionData)
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    document.getElementById('successModal').classList.add('active');
                } else {
                    showToast(data.detail || 'Failed to save session', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.clear();
            window.location.href = '/login';
        });

        loadChildInfo();
    </script>
</body>
</html>
